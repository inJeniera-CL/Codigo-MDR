CREATE OR REPLACE VIEW sdx_ti_mdr.vw_mdr_04_tp AS 
SELECT
	  vw_mdr_03.id_proceso
	, vw_mdr_03.tms_ingesta
	, vw_mdr_03.tms_extraccion_fuente
	, vw_mdr_03.lnin_sec
	, vw_mdr_03.fch_transaccion
	, vw_mdr_03.sid_tx_secuencia
	, vw_mdr_03.cdg_comercio
	, vw_mdr_03.mto_transaccion
	, vw_mdr_03.mto_comision
	, vw_mdr_03.mto_vuelto
	, vw_mdr_03.num_bin_ext
	, vw_mdr_03.cdg_producto_canal_contratado
	, vw_mdr_03.cdg_tipo_transaccion
	, vw_mdr_03.cdg_medio_pago
	, vw_mdr_03.ttx_cod_moneda_tr cdg_moneda_iso
	, vw_mdr_03.fch_procesamiento
	, vw_mdr_03.fch_cambio_uf
	, vw_mdr_03.fch_cambio_dolar
	, vw_mdr_03.num_periodo_gestion
	, vw_mdr_03.val_uf
	, vw_mdr_03.val_dolar
	, vw_mdr_03.mto_transaccion_clp
	, vw_mdr_03.mto_transaccion_uf
	, vw_mdr_03.mto_transaccion_usd
	, vw_mdr_03.mto_comision_uf
	, vw_mdr_03.mto_vuelto_uf
	, vw_mdr_03.ttx_tipo_flujo
	, vw_mdr_03.ttx_cod_rubro
	, vw_mdr_03.ttx_cod_moneda_tr
	, vw_mdr_03.ttx_monto_orig
	, vw_mdr_03.ttx_fecha
	, vw_mdr_03.ttx_tipo_tx
	, vw_mdr_03.ttx_tipo_tran
	, vw_mdr_03.ttx_nac_o_ext
	, vw_mdr_03.ttx_marca_bin
	, vw_mdr_03.ttx_tipo_contrato
	, vw_mdr_03.ttx_tipo_tarjeta
	, vw_mdr_03.ttx_medio_pago
	, vw_mdr_03.ttx_emisor
	, vw_mdr_03.ttx_iva_comision
	, vw_mdr_03.lnin_sec_ant
	, vw_mdr_03.identificador_producto
	, vw_mdr_03.partition_year
	, vw_mdr_03.partition_month
	, vw_mdr_03.partition_day
	, vw_mdr_03.flg_surcharge
	, vw_mdr_03.cod_mod_ti
	, mto_transaccion_sin_vuelto
	, mto_transaccion_sin_vuelto_uf
	, cod_cred
	, count_trx
	, vw_mdr_03.rut
	, vw_mdr_03.tipo_conexion
	, vw_mdr_03.cod_rubro
	, vw_mdr_03.emisor_fixed
	, vw_mdr_03.bin
	, vw_mdr_03.medio_pago_pucon
	, vw_mdr_03.marca_fixed
	, vw_mdr_03.emsr_gestion_fixed
	, vw_mdr_03.dsc_marca
	, CASE WHEN vw_mdr_03.bin IN ('555912','522416','412003','538759','410027','517608','531926', '523250', '518286') THEN 6
	WHEN vw_mdr_03.bin IN ('485029', '456918', '520079', '552300', '552595', '552665', '553405', '554940', '556083', '442679', '467498', '493857'
							 , '450802', '410530', '476026', '450882', '446511', '493858', '421917', '493859', '450883', '490225', '426040', '489472'
							 , '421401', '545646', '541944', '552813', '519741', '552635', '496672', '423925', '450838', '435767', '548569', '518850'
							 , '549451', '515658', '558727', '553656', '525731', '546039', '543563', '548480', '530250', '543565', '540491', '552561'
							 , '519716', '520387', '533225', '549162', '521892', '540477', '450880', '547369', '406496', '435718', '410886', '415280'
							 , '496671', '485722', '442174', '415281', '377827', '377829', '515547', '542412', '544630', '547184', '549289', '557806'
							 , '559045', '559542', '450881', '377828', '377825', '377826', '376645', '457615', '544568', '549070', '529885', '529881'
							 , '529883', '478688', '521408', '544623', '544916', '545415', '547196', '449595', '417760', '419189', '543696', '540937'
							 , '547551', '552252', '554904', '559800', '515460', '521312', '533013', '545196', '554610', '558347', '559801', '476832'
							 , '554926', '456477', '456460', '456473', '552559', '518532', '541678', '542663', '540523', '557861', '518472', '518497'
							 , '518536', '438084', '445596', '467024', '467025', '479595', '480048', '404028', '460072', '499847', '465375', '409152'
							 , '558984', '512269', '548740', '522468', '548742', '415282', '415283', '543564', '450878', '469772', '476025', '492210'
							 , '496670', '498811', '422766', '434956', '446867', '448480', '459311', '475776', '480293', '480916', '480917', '540476'
							 , '540782', '548652', '548653', '549163', '534129', '522832', '546689', '558685', '558840', '489070', '559202', '559205'
							 , '559207', '544938', '425947', '463307', '409320', '423471', '451248', '424525', '425944', '424419', '403351', '414756'
							 , '454812', '496617', '448165', '422038', '448542', '450600', '454851', '454886', '496660', '480015', '222690', '517980'
							 , '535851', '542714', '531663', '552273', '568009', '531216', '539032', '544088', '545153', '416589', '456931', '494611', '401082') THEN 4
	WHEN vw_mdr_03.bin IN ('589738', '462956', '402366', '402365', '451134', '440698', '590101', '589691', '589710', '559779', '589693'
							 , '502976', '533187', '409767', '421413', '434503', '434561', '434560', '621996', '434559', '491098', '524101'
							 , '503441', '524241', '429954', '430271', '508113', '589701', '493807', '467015', '456865', '475775', '475777'
							 , '477041', '475774', '450638', '463306', '421767', '475778', '590202', '420861', '420862', '409674', '425943'
							 , '491523', '451368', '498432', '452427', '525384', '531596', '589688', '505780', '489644', '542676') THEN 5
	  ELSE vw_mdr_03.medio_pago_pucon END AS medio_pago_pucon_fixed
FROM sdx_ti_mdr.vw_mdr_03_tp vw_mdr_03;